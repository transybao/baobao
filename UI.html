<!DOCTYPE html>
<html>
<head>
	<title>Real time chat application</title>
	<style>
		#chat
		{
			width:500px;
			height:500px;
			overflow:auto;
			border:1px solid red;
		}
		#message
		{
			width:450px;
			height:30px;
		}

	</style>
	<style type="text/css" media="screen">
		html, body {height: 98%; position: relative; margin: 0;}
		body {
		  font-family: Helvetica, Arial, serif;
		  font-size: 16px;
		  padding: 1%
		}
		.wrapper {
		  width: 612px;
		  height: 100%;
		  margin: 0 auto;
		}

		.phone-containter {
		  width: 340px;
		  height: 100%;
		}
		.phone {
		  height: 60%;
		  border: 1px solid #dcdcdc;
		  overflow-y: auto;
		  overflow-x: hidden;
		}
		.button {
		  background-color: none;
		  border: 1px solid #36a9fc;
		  text-decoration: none;
		  border-radius: 10px;
		  padding: 5px 10px;
		  color: #36a9fc;
		  display: block;
		  width: 80px;
		  text-align: center;
		  overflow: hidden;
		  text-oveflow: ellipsis;
		  margin: 20px auto;
		}

		.build-container {
		  width: 230px;
		  height: 100%;
		  margin-left: 20px;
		  float: right;
		}
		#buildInput {
		  width: 100%;
		  height: 60%;
		}

		/* Messages baloon */
		.message {
		  margin: 10px 0;
		  overflow: hidden;
		}
		.message-text {
		  padding: 10px 20px;
		  float: right;
		  clear: both;
		  border-radius: 25px;
		  position: relative;
		  margin-bottom: 1px;
		}
		.message.left .message-text {
		  margin-right: 70px;
		  margin-left: 20px;
		  background-color: #e5e5ea;
		  float: left;
		}
		.message.right .message-text {
		  margin-left: 70px;
		  margin-right: 20px;
		  background-color: #36a9fc;
		  color: #fff;
		  float: right;
		}

		.message-text:last-child:before,
		.message-text:last-child:after {
		  content: '';
		  position: absolute;
		  bottom: 0;
		  width: 35px;
		  height: 25px;
		  z-index: -1;
		}

		.message.right .message-text:before,
		.message.right .message-text:after {
		  border-radius: 0 0 0 50%;
		}
		.message.right .message-text:before {
		  height: 20px;
		  right: -23px;
		  background-color: #36a9fc;
		}
		.message.right .message-text:after {
		  right: -35px;
		  bottom: -3px;
		  background-color: #fff;
		}


		.message.left .message-text:before,
		.message.left .message-text:after {
		  border-radius: 0 0 50% 0;
		}
		.message.left .message-text:before {
		  height: 20px;
		  left: -23px;
		  background-color: #e5e5ea;
		}
		.message.left .message-text:after {
		  left: -35px;
		  bottom: -3px;
		  background-color: #fff;
		}

		.send-container {
		  background-color: #f6f6f6;
		  border: 1px solid #dcdcdc;
		  margin-top: -1px;
		  padding: 10px;
		}
		.send-input {
		  border-radius: 5px;
		  border: 1px solid #dbdbdb;
		  background-color: #fff;
		  padding: 5px 5px;
		  font-size: 1em;
		  width: 78%;
		}
		.send-btn {
		  text-decoration: none;
		  color: #939297;
		  font-weight: bold;
		  background-color: transparent;
		  border: none;
		  font-size: 1em;
		  cursor: pointer;
		}
	</style>

</head>
<body>
	<div id="chat">
		
	</div>
	<br>
	<form id="send_message">
		<input type="text" id="message"/>
		<input type="submit" value="Send">
	</form>

	<!--New-->
	<div class="phone-containter">
	    <div id="phone" class="phone">
	      <div class="message left">
	      	<div class="message-text">Hello!</div>
		  </div>
			<div class="message right">
				<div class="message-text">Hi!</div>
			    <div class="message-text">Where are you now?</div>
			</div>
			<div class="message left">
				<div class="message-text">I'm at a party of Clara</div>
			</div>
	    </div>
	    
	    <div class="send-container">
	      <form id="send">
	      <input type="text" id="msgInput" class="send-input" placeholder="Message" />
	      <input type="submit" class="send-btn" value="Send">
	      </form>
	    </div>
    
  	</div>
  	<!--New-->

	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		
		$(document).ready(function() {
			var socket = io.connect();
			var messForm = $('#send_message');
			var mess = $('#message');
			var show = $('#chat');

			messForm.submit(function(e)
			{
				e.preventDefault();
				//gửi data lên server
				socket.emit('send mess', mess.val());
				mess.val('');
			});

			//client nhận data trả về từ server
			socket.on('new mess', function(data){
				show.append(data + '<br/>');
			});

		});
	</script>

	<script type="text/javascript">
		$(document).ready(function() {
			$('#build').bind('click', function() {
			  var inputText = $('#buildInput').val();
			  var regMessage = /^#(\d):\s([^#.]*)/gm;
			  var messages = inputText.split(regMessage);
			  $('#phone').empty();
			  for (var i=1; i<messages.length; i=i+3) {
			    addMsg(messages[i], messages[i+1]);
			  }
			  return false;
			})

			$('#send').bind('submit', function(e) {
				e.preventDefault();
			  var msgText = $('#msgInput').val();
			  $('#msgInput').val('');
			  
			  if (msgText != '') addMsg(1, msgText);
			  
			  $('#phone').animate({ scrollTop: $('#phone').height() }, 600);
			  
			  return false;
			})

			function addMsg(people, msg) {
			  
			  var side = 'right';
			  var $_phone = $('#phone');
			  var $_lastMessage = $('#phone .message:last');
			  
			  if (people == 1) side = 'right';
			  if (people == 2) side = 'left';
			  
			  if ($_lastMessage.hasClass(side)) {
			    
			    $_lastMessage.append(
			      $('<div>').addClass('message-text').text(msg)
			    )
			    
			  } else {
			    
			    $_phone.append(
			      $('<div>').addClass('message '+side).append(
			        $('<div>').addClass('message-text').text(msg)
			      )
			    )
			    
			  }
			  
			}
		});		
	</script>
</body>
</html>